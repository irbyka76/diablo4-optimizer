<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Diablo 4 Optimizer</title>
  <script>
    const whTooltips = {colorLinks: true, iconizeLinks: true, renameLinks: true};
  </script>
  <script src="https://wow.zamimg.com/js/tooltips.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #1a1a1a;
      color: #f0f0f0;
      margin: 0;
      padding: 20px;
    }
    h1 {
      color: #ffcc00;
    }
    select, input[type="text"] {
      padding: 8px;
      margin: 5px;
      background-color: #2a2a2a;
      color: #fff;
      border: 1px solid #444;
    }
    .gear-container {
      margin-top: 20px;
    }
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      z-index: 1000;
    }
    .modal-content {
      background-color: #222;
      margin: 10% auto;
      padding: 20px;
      border: 1px solid #888;
      width: 80%;
      color: #fff;
    }
    .modal-header, .modal-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    .modal-body {
      display: flex;
      gap: 20px;
    }
    .gear-list-container {
      width: 40%;
      border-right: 1px solid #555;
      padding-right: 10px;
    }
    .gear-stats-container {
      width: 60%;
      padding-left: 10px;
    }
    .stat-entry {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }
    .greater-affix-toggle {
      margin-left: 10px;
    }
    .aspect-list li {
      cursor: pointer;
      padding: 5px;
      border-bottom: 1px solid #444;
    }
    .aspect-list li:hover, .aspect-list li.selected {
      background-color: #333;
    }
    .cancel-btn, .apply-btn {
      padding: 8px 16px;
      background-color: #555;
      color: #fff;
      border: none;
      cursor: pointer;
    }
    .cancel-btn:hover, .apply-btn:hover {
      background-color: #777;
    }
  </style>
</head>
<body>
  <h1>Diablo 4 Build Optimizer</h1>
  <label for="class-select">Select Class:</label>
  <select id="class-select" onchange="updateGearSlots()">
    <option value="barbarian">Barbarian</option>
    <option value="druid">Druid</option>
    <option value="necromancer">Necromancer</option>
    <option value="rogue">Rogue</option>
    <option value="sorcerer">Sorcerer</option>
    <option value="spiritborn">Spiritborn</option>
  </select>

  <button onclick="openModal()">Add Gear</button>
  <div id="gear-inputs" class="gear-container"></div>

  <div class="modal" id="gearModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Select Gear or Aspect</h2>
        <span style="cursor:pointer" onclick="closeModal()">&times;</span>
      </div>
      <div class="modal-body">
        <div class="gear-list-container">
          <input type="text" id="gearSearch" placeholder="Search..." oninput="filterGearList()">
          <ul class="aspect-list" id="gearList"></ul>
        </div>
        <div class="gear-stats-container" id="gearStats">
          <h3>Stats <span style="font-size:0.8em;color:gray">(optional)</span></h3>
          <div id="statInputs">
            <div class="stat-entry">
              <input type="text" placeholder="e.g. 30% Attack Speed">
              <input type="checkbox" class="greater-affix-toggle" title="Greater Affix">
            </div>
            <div class="stat-entry">
              <input type="text" placeholder="e.g. 110 All Stats">
              <input type="checkbox" class="greater-affix-toggle" title="Greater Affix">
            </div>
            <div class="stat-entry">
              <input type="text" placeholder="e.g. 86 Life On Hit">
              <input type="checkbox" class="greater-affix-toggle" title="Greater Affix">
            </div>
            <div class="stat-entry">
              <input type="text" placeholder="e.g. 10% Maximum Resistance">
              <input type="checkbox" class="greater-affix-toggle" title="Greater Affix">
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="cancel-btn" onclick="closeModal()">Cancel</button>
        <button class="apply-btn" onclick="applyGearSelection()">Apply</button>
      </div>
    </div>
  </div>

  <script>
    const gearOptions = [
      "<li onclick='selectGear(this)'><a href='https://www.wowhead.com/diablo-4/item/harlequin-crest-609820' class='d4-q5'>Harlequin Crest</a></li>",
      "<li onclick='selectGear(this)'><a href='https://www.wowhead.com/diablo-4/aspect/aspect-of-audacity-1288916' class='d4-q3'>Aspect of Audacity</a></li>"
    ];

    function applyGearSelection() {
      const selectedGear = document.querySelector("#gearList li.selected");
      const selectedGearName = selectedGear ? selectedGear.textContent.trim() : "";

      const statEntries = document.querySelectorAll("#statInputs .stat-entry");
      const stats = [];

      statEntries.forEach(entry => {
        const statText = entry.querySelector("input[type='text']").value.trim();
        const isGreaterAffix = entry.querySelector("input[type='checkbox']").checked;
        if (statText) {
          stats.push({ text: statText, greaterAffix: isGreaterAffix });
        }
      });

      console.log("Selected Gear:", selectedGearName);
      console.log("Stat Affixes:", stats);

      closeModal();
    }

    function updateGearSlots() {
      console.log("Class selected:", document.getElementById("class-select").value);
    }

    function closeModal() {
      document.getElementById("gearModal").style.display = "none";
    }

    function openModal() {
      document.getElementById("gearModal").style.display = "block";
      populateGearList();
    }

    function populateGearList() {
      const list = document.getElementById("gearList");
      list.innerHTML = gearOptions.join("");
    }

    function selectGear(item) {
      document.querySelectorAll("#gearList li").forEach(li => li.classList.remove("selected"));
      item.classList.add("selected");
    }

    function filterGearList() {
      const search = document.getElementById("gearSearch").value.toLowerCase();
      const list = document.querySelectorAll("#gearList li");

      list.forEach(li => {
        li.style.display = li.textContent.toLowerCase().includes(search) ? "block" : "none";
      });
    }
  </script>
</body>
</html>
